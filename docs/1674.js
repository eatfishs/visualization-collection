"use strict";(self.webpackChunkvisualization_collection=self.webpackChunkvisualization_collection||[]).push([[1674],{11590:(e,t,r)=>{r.d(t,{A:()=>s});r(96540);var c=r(6442);const n="ModuleTitle_container__rDjYN";var a=r(74848);const s=e=>{const t=(0,c.A)(),{intlTitle:r,style:s={}}=e;return(0,a.jsx)("div",{className:n,style:s,children:t.formatMessage({id:r})})}},81674:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var c=r(96540),n=r(6442),a=r(89740),s=r(11590);const u="MatchLine_container__v3hmk",o="MatchLine_content__6204Y",i="MatchLine_tools__nzmeK",l="MatchLine_btn__JNwAY",d="MatchLine_bottom__c3JXS",h="MatchLine_box__K9OBx",f="MatchLine_options__pXU7u",m="MatchLine_option__dE4ti",v="MatchLine_active__26bDO";var p=r(74848);const y={fruit:"🍌",animal:"🐒",car:"🚗",vegetable:"🥕"},k=()=>{const e=(0,n.A)(),t=(0,c.useRef)(null),r=(0,c.useRef)(null),k=(0,c.useRef)(null),g=(0,c.useRef)(null),x=(0,c.useRef)(null),_=(0,c.useRef)(null),L=(0,c.useRef)(null),b=(0,c.useRef)(null),j=(0,c.useRef)(null),R=(0,c.useRef)({x:0,y:0}),N=(0,c.useRef)({x:0,y:0}),w=(0,c.useRef)(!1),M=(0,c.useRef)([]),E=(0,c.useRef)({}),C=(0,c.useRef)(Object.values(y).sort((()=>Math.random()-.5))),D=(0,c.useRef)(!1),A=e=>{k.current&&x.current&&(x.current.clearRect(0,0,k.current.width,k.current.height),e.forEach((e=>{let{point:{x1:t,y1:r,x2:c,y2:n},isOk:a}=e;x.current&&(x.current.strokeStyle="boolean"==typeof a?a?"#3CB371":"#DC143C":"#6495ED",x.current.beginPath(),x.current.moveTo(t,r),x.current.lineTo(c,n),x.current.closePath(),x.current.stroke())})))},O=(0,c.useCallback)((t=>{t.stopPropagation(),t.preventDefault(),D.current?a.Ay.warning(e.formatMessage({id:"page.canvasDynamicEffect.pleaseReset"})):(t.target.classList.add(v),b.current=t.target,b.current.dataset.checked="1",j.current=null,R.current.x=Number(t.target.dataset.anchorX),R.current.y=Number(t.target.dataset.anchorY),w.current=!0)}),[]),Y=(0,c.useCallback)((e=>{if(e.stopPropagation(),e.preventDefault(),w.current&&r.current&&g.current){const{clientX:t,clientY:c}=e,{left:n,top:a}=r.current.getBoundingClientRect();N.current={x:t-n,y:c-a},g.current.clearRect(0,0,r.current.width,r.current.height),g.current.beginPath(),g.current.moveTo(R.current.x,R.current.y),g.current.lineTo(N.current.x,N.current.y),g.current.closePath(),g.current.stroke();const s=document.elementFromPoint(t,c);if(s){if(b.current){const e=b.current.dataset.ownership;if(s===j.current)return;const t=s.dataset.ownership,r=s.dataset.ownership!==e,c="1"!==s.dataset.checked;t&&r&&c?(j.current=s,j.current.classList.add(v),j.current.dataset.checked="1"):j.current&&(j.current.classList.remove(v),j.current.dataset.checked="0",j.current=null)}}else j.current&&(j.current.classList.remove(v),j.current.dataset.checked="0",j.current=null)}}),[]),S=(0,c.useCallback)((e=>{if(e.stopPropagation(),e.preventDefault(),w.current){if(b.current&&j.current&&"1"===b.current.dataset.checked&&"1"===j.current.dataset.checked){const{anchorX:e,anchorY:t,ownership:r,value:c}=b.current.dataset,{anchorX:n,anchorY:a,value:s}=j.current.dataset,u=Object.keys(E.current),o=Object.values(E.current);if(c&&(u.includes(c)||o.includes(c))){let e="",t="";for(let r=0;r<u.length;r++){const n=u[r],a=o[r];if([n,a].includes(c)){e=n,t=n===c?a:n;break}}const r="[data-value=".concat(t,"]"),n=document.querySelector(r);if(n){n.dataset.checked="0",n.classList.remove(v),delete E.current[e];const t=M.current.findIndex((t=>t.key===e));t>=0&&M.current.splice(t,1)}}const i="L"===r?c:s,l="L"===r?s:c;E.current[i]=l,M.current.push({key:i,point:{x1:e,y1:t,x2:n,y2:a}}),A(M.current)}else if(b.current){(e=>{let t=!1;if(e){const r=Object.keys(E.current),c=Object.values(E.current);(r.includes(e)||c.includes(e))&&(t=!0)}return t})(b.current.dataset.value)||(b.current.dataset.checked="0",b.current.classList.remove(v))}w.current=!1,b.current=null,j.current=null,r.current&&g.current&&g.current.clearRect(0,0,r.current.width,r.current.height)}}),[]),X=e=>{e&&Array.prototype.forEach.call(e.children,(e=>{const{width:t,height:r}=e.getBoundingClientRect(),c="L"===e.dataset.ownership?e.offsetLeft+t:e.offsetLeft,n=e.offsetTop+r/2;e.dataset.anchorX=c,e.dataset.anchorY=n,e.dataset.checked="0",e.onmousedown=O}))};(0,c.useEffect)((()=>((()=>{if(t.current&&r.current&&k.current){const{clientWidth:e,clientHeight:c}=t.current;r.current.width=k.current.width=e,r.current.height=k.current.height=c,g.current=r.current.getContext("2d"),x.current=k.current.getContext("2d"),g.current.strokeStyle=x.current.strokeStyle="#6495ED",g.current.lineWidth=x.current.lineWidth=2,X(_.current),X(L.current)}})(),document.addEventListener("mousemove",Y),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",Y),document.removeEventListener("mousemove",S)})),[]);return(0,p.jsxs)("div",{className:u,children:[(0,p.jsx)(s.A,{intlTitle:"page.canvasDynamicEffect.matchLineQuestion"}),(0,p.jsxs)("div",{className:o,children:[(0,p.jsxs)("div",{className:i,children:[(0,p.jsx)("div",{className:l,onClick:()=>{_.current&&Array.prototype.forEach.call(_.current.children,(e=>{e.dataset.checked="0",e.classList.remove(v)})),L.current&&Array.prototype.forEach.call(L.current.children,(e=>{e.dataset.checked="0",e.classList.remove(v)})),M.current=[],E.current={},A(M.current),D.current=!1},children:e.formatMessage({id:"common.reset"})}),(0,p.jsx)("div",{className:l,onClick:()=>{if(D.current)return void a.Ay.warning(e.formatMessage({id:"page.canvasDynamicEffect.pleaseReset"}));const t=M.current.pop();if(t){const{key:e}=t,r='[data-value="'.concat(e,'"]'),c='[data-value="'.concat(E.current[e],'"]');delete E.current[e];const n=document.querySelector(r),a=document.querySelector(c);n&&a&&(n.dataset.checked=a.dataset.checked="0",n.classList.remove(v),a.classList.remove(v),A(M.current))}},children:e.formatMessage({id:"common.backout"})}),(0,p.jsx)("div",{className:l,onClick:()=>{if(D.current)return;const t=Object.keys(E.current);if(0===t.length)return void a.Ay.error(e.formatMessage({id:"page.canvasDynamicEffect.noVerifiableAnswer"}));const r=[];t.forEach((e=>{const t=E.current[e],c='[data-value="'.concat(e,'"]'),n="[data-value=".concat(t,"]"),a=document.querySelector(c),s=document.querySelector(n);if(a&&s){const{anchorX:c,anchorY:n}=a.dataset,{anchorX:u,anchorY:o}=s.dataset,i=y[e];r.push({isOk:t===i,point:{x1:c?Number(c):0,y1:n?Number(n):0,x2:u?Number(u):0,y2:o?Number(o):0}})}})),A(r),D.current=!0},children:e.formatMessage({id:"common.checkout"})})]}),(0,p.jsx)("div",{className:d,children:(0,p.jsxs)("div",{className:h,ref:t,children:[(0,p.jsx)("div",{className:f,ref:_,children:Object.keys(y).map((t=>(0,p.jsx)("div",{className:m,"data-value":t,"data-ownership":"L",children:e.formatMessage({id:"page.canvasDynamicEffect.".concat(t)})})))}),(0,p.jsx)("div",{className:f,ref:L,children:C.current.map((e=>(0,p.jsx)("div",{className:m,"data-value":e,"data-ownership":"R",children:e})))}),(0,p.jsx)("canvas",{ref:r}),(0,p.jsx)("canvas",{ref:k})]})})]})]})}}}]);