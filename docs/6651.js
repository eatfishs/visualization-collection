(self.webpackChunkvisualization_collection=self.webpackChunkvisualization_collection||[]).push([[6651],{11590:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});t(96540);var n=t(6442);const c="ModuleTitle_container__rDjYN";var s=t(74848);const i=e=>{const r=(0,n.A)(),{intlTitle:t,style:i={}}=e;return(0,s.jsx)("div",{className:c,style:i,children:r.formatMessage({id:t})})}},6621:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var n=t(96540),c=t(89740),s=t(68777),i=t(6442),o=t(1188),a=(t(86748),t(9033),t(11590));const u="HumanPostureDetection_container__02pq8",l="HumanPostureDetection_content__7virt";var d=t(74848),m=function(e){return e[e.ready=0]="ready",e[e.inRecording=1]="inRecording",e}(m||{});const f=Math.floor(.55*window.screen.width),g=Math.floor(.55*window.screen.height),h=f%2==0?f:f+1,y=g%2==0?g:g+1,v=()=>{const e=(0,i.A)(),r=(0,n.useRef)(null),t=(0,n.useRef)(null),f=(0,n.useRef)(null),[g,v]=(0,n.useState)(m.ready),p=(0,n.useRef)(null),w=(0,n.useRef)(null),x=(0,n.useRef)(null),M=async()=>{if(t.current&&r.current&&w.current){var e;if(!r.current.srcObject)return;w.current.drawImage(r.current,0,0,h,y);const n=w.current.getImageData(0,0,h,y),c=(null===(e=(await t.current.estimatePoses(n,{flipHorizontal:!1,maxPoses:1,scoreThreshold:.5,nmsRadius:20}))[0])||void 0===e?void 0:e.keypoints)||[];c.forEach((e=>{let{x:r,y:t,score:n}=e;n>.5&&((e,r,t,n,c)=>{c.beginPath(),c.arc(e,r,t,0,2*Math.PI),c.fillStyle=n,c.fill()})(r,t,6,"#f00000",w.current)}));o.ZS.getAdjacentPairs(o.JZ.PoseNet).forEach((e=>{let[r,t]=e;if(c&&c.length>=2){const e=c[r],n=c[t],s=null!=e.score?e.score:0,i=null!=n.score?n.score:0;s>=.5&&i>=.5&&((e,r,t,n,c)=>{let[s,i]=e,[o,a]=r;c.beginPath(),c.moveTo(s*n,i*n),c.lineTo(o*n,a*n),c.lineWidth=4,c.strokeStyle=t,c.stroke()})([e.x,e.y],[n.x,n.y],"aqua",1,w.current)}})),x.current=window.setTimeout((()=>{M()}),50)}};return(0,n.useEffect)((()=>{(()=>{if(p.current){p.current.width=h,p.current.height=y;const e=p.current.getContext("2d");w.current=e}})()}),[]),(0,d.jsxs)("div",{className:u,children:[(0,d.jsx)(a.A,{intlTitle:"page.AIApplication.humanPostureDetection"}),(0,d.jsxs)("div",{className:l,style:{width:"".concat(h,"px"),height:"".concat(y,"px")},children:[(0,d.jsx)("video",{style:{width:"".concat(h,"px"),height:"".concat(y,"px")},muted:!0,autoPlay:!0,"x5-video-player-fullscreen":"true","x5-playsinline":"true",playsInline:!0,"webkit-playsinline":"true",crossOrigin:"anonymous",ref:r}),(0,d.jsx)("canvas",{ref:p,children:e.formatMessage({id:"common.browserTooLow"})})]}),(0,d.jsx)(s.Ay,{type:"primary",onClick:async()=>{if(f.current&&t.current)g===m.inRecording?(r.current&&(r.current.srcObject=null),x.current&&(window.clearTimeout(x.current),x.current=null),v(m.ready),setTimeout((()=>{var e;w.current&&(null===(e=w.current)||void 0===e||e.clearRect(0,0,h,y))}),50)):(r.current&&(r.current.srcObject=f.current,M()),v(m.inRecording));else if(r.current){const n={audio:!1,video:{width:h,height:y,facingMode:"user",frameRate:60}};navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(n).then((async e=>{if(r.current&&e&&(f.current=e),r.current&&f.current){r.current.srcObject=f.current;const e=o.JZ.PoseNet,n=await o.Fz(e,{modelType:"full"});t.current=n,M()}v(m.inRecording)})).catch((r=>{r.message&&r.message.includes("not found")?c.Ay.error(e.formatMessage({id:"common.deviceNotFound"})):r.message&&r.message.includes("Invalid architecture full")?c.Ay.error(r.message):c.Ay.error(e.formatMessage({id:"common.impowerOpenCamera"}))})):c.Ay.error(e.formatMessage({id:"common.notSupportGetUserMedia"}))}},children:g===m.inRecording?e.formatMessage({id:"common.end"}):e.formatMessage({id:"common.start"})})]})}},85817:()=>{},18590:()=>{},41234:()=>{}}]);